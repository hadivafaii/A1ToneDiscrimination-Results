
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Processing &#8212; A1 Tone Discrimination</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Classification Analysis" href="clf.html" />
    <link rel="prev" title="Section 1" href="sec1.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">A1 Tone Discrimination</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="reference internal" href="sec1.html">
   Section 1
  </a>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Data Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="clf.html">
     Classification Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lda.html">
     Linear Discriminant Analysis (LDA)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="clf-limited.html">
     Classification Analysis (with limited time interval) + supervised PCA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="mlp.html">
     Multi-layer Perceptron analysis (MLP)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="sec2.html">
   Section 2
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/processing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hadivafaii/A1ToneDiscrimination"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hadivafaii/A1ToneDiscrimination/issues/new?title=Issue%20on%20page%20%2Fprocessing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hadivafaii/A1ToneDiscrimination/master?urlpath=tree/docs/processing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#print-data-summary">
   Print data summary
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pie-chart-as-a-visual-summary">
     Pie chart as a visual summary
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outlier-removal">
     Outlier removal
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-average-traces-licks-etc">
   Plot average traces, licks etc
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-responses-for-different-behavior-frequencies">
     Average responses for different behavior frequencies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-responses-for-different-passive-frequencies">
     Average responses for different passive frequencies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#counting-the-number-of-sup-and-exc-cells">
     Counting the number of SUP and EXC cells
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#average-response-for-different-trials">
     Average response for different trials
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#single-cells-vs-population">
   Single cells vs Population
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frequency">
     Frequency
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trial-labels">
     Trial labels
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#from-these-analysis-we-conclude-that-we-need-population-level-analysis-duh">
     From these analysis we conclude that we need population level analysis (duh)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nearest-neighbor-analysis">
   Nearest Neighbor analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Trial labels
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#connectivity-matrix">
       Connectivity matrix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-top-30-neighbors">
       Plot top 30 neighbors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#find-label-for-top-30-neighbors">
       Find label for top 30 neighbors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#do-neighbors-have-more-or-less-the-same-label">
       Do neighbors have more or less the same label?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conclusion-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-trial-label">
       Conclusion: there is not much of shared structure in single cell traces as a function of trial label
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stim-frequencies">
     Stim frequencies
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Connectivity matrix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Plot top 30 neighbors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Find label for top 30 neighbors
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Do neighbors have more or less the same label?
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#conclusion-similarly-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-stim-frequency">
       Conclusion: similarly, there is not much of shared structure in single cell traces as a function of stim frequency
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simply-looking-at-averages-is-misleading">
   Simply looking at averages is misleading
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1-a-cell-that-is-highly-active-during-hit-and-falsealarm-trials">
     Example 1: a cell that is highly active during hit and falsealarm trials
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2-a-cell-that-is-highly-active-during-hit-but-not-consistently">
     Example 2: a cell that is highly active during hit, but not consistently.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3-excited-during-hit-and-falsealaram-inhibited-during-miss-and-correctreject">
     Example 3: excited during hit and falsealaram, inhibited during miss and correctreject
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-4-seems-random">
     Example 4: seems random
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-5-highly-active-during-correctreject-and-to-some-extent-during-hit">
     Example 5: highly active during correctreject, and to some extent during hit
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-6-can-be-used-to-classify-hit-vs-antything-else">
     Example 6: can be used to classify hit vs antything else
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-7-another-random-cell">
     Example 7: another random cell
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   Discussion
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="data-processing">
<h1>Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span> <span class="k">as</span> <span class="n">dc</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">github_path</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;Dropbox/git/A1ToneDiscrimination/&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">github_path</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils.process</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utils.plot_functions</span> <span class="kn">import</span> <span class="n">mk_pie_plot</span><span class="p">,</span> <span class="n">mk_data_summary_plot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">ced8e06a2f34</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">github_path</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;Dropbox/git/A1ToneDiscrimination/&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">github_path</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">utils.process</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">utils.plot_functions</span> <span class="kn">import</span> <span class="n">mk_pie_plot</span><span class="p">,</span> <span class="n">mk_data_summary_plot</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;utils&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;Documents/A1&#39;</span><span class="p">)</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">results_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Get raw data and organize it in python h5 files.  Data processing:</p>
<ul class="simple">
<li><p>First step was to remove traces that contained NaN.  This sometimes meant removing entire trials that had NaN for all neurons in the experiment, and sometime meant removing neurons that had NaN in all their trials.</p></li>
<li><p>Next step was to identify and remove outlier neurons.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nb_std</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">organize_data</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">nb_std</span><span class="o">=</span><span class="n">nb_std</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[INFO] file found. exiting...
</pre></div>
</div>
</div>
</div>
<div class="section" id="print-data-summary">
<h2>Print data summary<a class="headerlink" href="#print-data-summary" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">processed_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;python_processed&#39;</span><span class="p">)</span>
<span class="n">h_load_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">processed_dir</span><span class="p">,</span> <span class="s2">&quot;organized_nb_std=</span><span class="si">{:d}</span><span class="s2">.h5&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_std</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="n">summarize_data</span><span class="p">(</span><span class="n">h_load_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>*** Data Summary ***
---------------------------------------------
- num experiments: 34,
- num animals: 9,
- num good cells: 2457,    
- num behavior trials 3953,
- num passive trials 1839,    

- num/percent different trials:
	○ correctreject: 1411 (36%)
	○ hit: 1180 (30%)
	○ earlyhit: 411 (10%)
	○ falsealarm: 329 (8%)
	○ miss: 295 (7%)
	○ early: 199 (5%)
	○ earlyfalsealarm: 123 (3%)

- percent frequencies used (behavior):
	○ 7000 Hz: 26%
	○ 9899 Hz: 26%
	○ 14000 Hz: 25%
	○ 19799 Hz: 25%

- percent frequencies used (passive):
	○ 4000 Hz: 7%
	○ 5000 Hz: 6%
	○ 5657 Hz: 7%
	○ 7071 Hz: 6%
	○ 8000 Hz: 7%
	○ 10000 Hz: 6%
	○ 11314 Hz: 7%
	○ 14142 Hz: 6%
	○ 16000 Hz: 7%
	○ 20000 Hz: 6%
	○ 22627 Hz: 7%
	○ 28284 Hz: 6%
	○ 32000 Hz: 7%
	○ 40000 Hz: 6%
	○ 45255 Hz: 7%
	○ 56569 Hz: 6%

- percent stim levels used (behavior):
	○ 75 dB: 77%
	○ 70 dB: 11%
	○ 55 dB: 8%
	○ 60 dB: 5%

- percent stim levels used (passive):
	○ 75 dB: 46%
	○ 64 dB: 35%
	○ 55 dB: 18%
	○ 60 dB: 3%
---------------------------------------------
</pre></div>
</div>
</div>
</div>
<div class="section" id="pie-chart-as-a-visual-summary">
<h3>Pie chart as a visual summary<a class="headerlink" href="#pie-chart-as-a-visual-summary" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_pie_plot</span><span class="p">(</span>
    <span class="n">summary_data</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_8_0.png" src="_images/processing_8_0.png" />
</div>
</div>
</div>
<div class="section" id="outlier-removal">
<h3>Outlier removal<a class="headerlink" href="#outlier-removal" title="Permalink to this headline">¶</a></h3>
<p>To ensure results are not corrupted by noisy samples, I identify a small subset of neurons as outliers and remove them.  To detect these neurons, I calculated the <span class="math notranslate nohighlight">\(p\)</span>-norm for 2 values of <span class="math notranslate nohighlight">\(p = 2\)</span> and <span class="math notranslate nohighlight">\(p = \inf\)</span>.   Then removed neurons with a norm that was <span class="math notranslate nohighlight">\(n_{std} = 1\)</span> std away from the mean norm.  I think what Manasij did was similar to <span class="math notranslate nohighlight">\(p = \inf\)</span> case.  I decided to use <span class="math notranslate nohighlight">\(p = 2\)</span> instead since the end result didn’t really change.  Here is percentage of neurons removed depending on the threshold:</p>
<ul class="simple">
<li><p><strong>1 std:   8.92 % removed</strong></p></li>
<li><p>2 std:   4.68 % removed</p></li>
<li><p>3 std:   2.37 % removed</p></li>
<li><p>5 std:   0.77% removed</p></li>
</ul>
<p>This figure compares an example outlier neuron’s trace to other neurons form the same experiment/trial.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.pkl&#39;</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Gabby&quot;</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2016-09-07&quot;</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">bright_cells</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;bright_cells&#39;</span><span class="p">]</span>
<span class="n">hit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;hit&#39;</span><span class="p">]</span>
<span class="n">dff</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dff&#39;</span><span class="p">]</span>

<span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">bright_cells</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][:,</span> <span class="n">hit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dff</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DFF&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;All bright cells w/ outlier&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dff</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DFF&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;All bright cells w/o outlier&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;name = </span><span class="si">{}</span><span class="s2">, date = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_10_0.png" src="_images/processing_10_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="plot-average-traces-licks-etc">
<h2>Plot average traces, licks etc<a class="headerlink" href="#plot-average-traces-licks-etc" title="Permalink to this headline">¶</a></h2>
<p>load the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_df_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">processed_dir</span><span class="p">,</span> <span class="s1">&#39;processed_nb_std=</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_std</span><span class="p">),</span> <span class="s2">&quot;all.df&quot;</span><span class="p">)</span>
<span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">load_df_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="average-responses-for-different-behavior-frequencies">
<h3>Average responses for different behavior frequencies<a class="headerlink" href="#average-responses-for-different-behavior-frequencies" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>target: 7, 10 kHz</p></li>
<li><p>nontarget: 14, 20, kHz</p></li>
</ul>
<p>Avg across all experiments. Passive trials also included.  Interestingly, at f = 14kHz avg traces for passive and falsealarm trials overlap almost perfectly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_freqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span> <span class="o">!=</span> <span class="s1">&#39;passive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">behavior_freqs</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">7000</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">7071</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">9899</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">14000</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">14142</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;correctreject&#39;</span><span class="p">,</span> <span class="s1">&#39;falsealarm&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">19799</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">20000</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;correctreject&#39;</span><span class="p">,</span> <span class="s1">&#39;falsealarm&#39;</span><span class="p">]</span>
    <span class="n">trials_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;passive&#39;</span><span class="p">])</span>
    
    <span class="n">selected_df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_all</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">freq_list</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trials_list</span><span class="p">))]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">selected_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;timepoint&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dff&#39;</span><span class="p">,</span>
                 <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="n">trials_list</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_14_0.png" src="_images/processing_14_0.png" />
</div>
</div>
</div>
<div class="section" id="average-responses-for-different-passive-frequencies">
<h3>Average responses for different passive frequencies<a class="headerlink" href="#average-responses-for-different-passive-frequencies" title="Permalink to this headline">¶</a></h3>
<p>Avg over all passive trials. The bar plot shows a clear distinction between target (7, 10 kHz) and nontarget (14, 20 kHz) frequencies vs the rest.  As a result of intense training, the animals become much more selective to these frequencies.  The only anomaly here is at 5kHz.  What could cause this increase in response intensity?  This is not explainable by saying 5k is close to 7k, because then what about 5.6 k?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">selected_df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span> <span class="o">==</span> <span class="s1">&#39;passive&#39;</span><span class="p">]</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">selected_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;timepoint&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dff&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;stimfreq&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">selected_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">selected_df</span><span class="o">.</span><span class="n">timepoint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;max_act&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;stimfreq&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_16_0.png" src="_images/processing_16_0.png" />
</div>
</div>
</div>
<div class="section" id="counting-the-number-of-sup-and-exc-cells">
<h3>Counting the number of SUP and EXC cells<a class="headerlink" href="#counting-the-number-of-sup-and-exc-cells" title="Permalink to this headline">¶</a></h3>
<p>To get more insights into this, here I plot the number of SUP and EXC cells during passive trials in each frequency.  Number of suppressed cells is noticably lower for behavior frequencies 7, 10, 14, and 20 kHz, plus 5 kHz.  I wonder if this is a recording artifact, or if there is a better explantion?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">selected_df</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">unique</span><span class="p">())):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="mi">8</span><span class="p">,</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">8</span>
    <span class="n">_df</span> <span class="o">=</span> <span class="n">selected_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">selected_df</span><span class="o">.</span><span class="n">timepoint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">selected_df</span><span class="o">.</span><span class="n">stimfreq</span> <span class="o">==</span> <span class="n">freq</span><span class="p">)]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cell_tag&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SUP&#39;</span><span class="p">,</span><span class="s1">&#39;EXC&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f = </span><span class="si">{:.1f}</span><span class="s2"> kHz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_18_0.png" src="_images/processing_18_0.png" />
</div>
</div>
</div>
<div class="section" id="average-response-for-different-trials">
<h3>Average response for different trials<a class="headerlink" href="#average-response-for-different-trials" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>top row shows average traces across neurons for given trial types. each subplot inclues:</p>
<ul>
<li><p>avg <strong>EXC</strong> response (cells that on average were excited during that trial)</p></li>
<li><p>avg <strong>SUP</strong> response (cells that on average were suppressed during that trial)</p></li>
<li><p>avg overall</p></li>
</ul>
</li>
<li><p>2nd row is average lick traces</p></li>
<li><p>3rd row shows the distribution of EXC/SUP cells for each trial type</p></li>
<li><p>last row shows avg of the largest activation for EXC and SUP across trial types (if data were zscored, this plot would be more or les flat)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_data_summary_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "", "version_major": 2, "version_minor": 0}
</script><img alt="_images/processing_20_1.png" src="_images/processing_20_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="single-cells-vs-population">
<h2>Single cells vs Population<a class="headerlink" href="#single-cells-vs-population" title="Permalink to this headline">¶</a></h2>
<p>Where is information about trial labels encoded? Can we reliably decode whether a single trace from a single cell is coming from a hit trial or a miss trial?  The answer is almost certainly not, but let’s quantify it here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trials</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">,</span> <span class="s1">&#39;correctreject&#39;</span><span class="p">,</span> <span class="s1">&#39;falsealarm&#39;</span><span class="p">]</span>
<span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7000</span><span class="p">,</span> <span class="mi">9899</span><span class="p">,</span> <span class="mi">14000</span><span class="p">,</span> <span class="mi">19799</span><span class="p">]</span>

<span class="n">l2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">trial</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials</span><span class="p">)}</span>
<span class="n">i2l</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">lbl</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="n">f2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">freq</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freqs</span><span class="p">)}</span>
<span class="n">i2f</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">freq</span> <span class="k">for</span> <span class="n">freq</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h_load_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">dff_freq</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dff_trial</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">df_freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df_trial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">behavior</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;behavior&#39;</span><span class="p">]</span>
    <span class="n">passive</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;passive&#39;</span><span class="p">]</span>

    <span class="n">good_cells_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">behavior</span><span class="p">[</span><span class="s2">&quot;good_cells&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">good_cells_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">passive</span><span class="p">[</span><span class="s2">&quot;good_cells&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">good_cells</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">good_cells_b</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">good_cells_p</span><span class="p">))</span>
    <span class="n">good_cells</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">good_cells</span><span class="p">))</span>

    <span class="n">stimfrequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">behavior</span><span class="p">[</span><span class="s1">&#39;trial_info&#39;</span><span class="p">][</span><span class="s1">&#39;stimfrequency&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">dff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">behavior</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="n">good_cells</span><span class="p">]</span>
    <span class="n">nt</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">shape</span>
    
    
    <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
        <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">behavior</span><span class="p">[</span><span class="s1">&#39;trial_info&#39;</span><span class="p">][</span><span class="n">trial</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dff_trial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dff</span><span class="p">[:,</span> <span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="n">cell_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cell_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">cell_indx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cell_indx&#39;</span><span class="p">:</span> <span class="n">cell_indx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">trial</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span> <span class="o">*</span> <span class="n">nc</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span> <span class="o">*</span> <span class="n">nc</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">df_trial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_trial</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)])</span>
    
    <span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
        <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">stimfrequency</span> <span class="o">==</span> <span class="n">freq</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dff_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dff</span><span class="p">[:,</span> <span class="n">indxs</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">cell_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cell_indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">cell_indx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cell_indx&#39;</span><span class="p">:</span> <span class="n">cell_indx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
            <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">freq</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span> <span class="o">*</span> <span class="n">nc</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span> <span class="o">*</span> <span class="n">nc</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">df_freq</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_freq</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)])</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
<span class="n">df_trial</span> <span class="o">=</span> <span class="n">reset_df</span><span class="p">(</span><span class="n">df_trial</span><span class="p">)</span>
<span class="n">df_freq</span> <span class="o">=</span> <span class="n">reset_df</span><span class="p">(</span><span class="n">df_freq</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 34/34 [00:01&lt;00:00, 20.85it/s]
</pre></div>
</div>
</div>
</div>
<div class="section" id="frequency">
<h3>Frequency<a class="headerlink" href="#frequency" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dff_freq</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">df_freq</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((251419, 135), (251419,))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f2i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tst_indxs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">freq</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">freq</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tst_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">trn_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">:])</span>
    
<span class="n">tst_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">trange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">][:,</span> <span class="n">trange</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">][:,</span> <span class="n">trange</span><span class="p">])</span>
<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.27155409142884673
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>classifier accuracy is ~27%, performs at chance level = 25%</p></li>
<li><p>we can’t reliably decode stim frequency from individual calcium traces</p></li>
</ul>
</div>
<div class="section" id="trial-labels">
<h3>Trial labels<a class="headerlink" href="#trial-labels" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dff_trial</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">df_trial</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((204736, 135), (204736,))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l2i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tst_indxs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
    <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">trial</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tst_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">trn_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">:])</span>
    
<span class="n">tst_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="n">penalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span>
    <span class="n">C</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">][:,</span> <span class="n">trange</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">][:,</span> <span class="n">trange</span><span class="p">])</span>
<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2677700838514673
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>again, classifier accuracy is ~27%, performs at chance level = 25%</p></li>
<li><p>we can’t reliably decode trial labels from individual calcium traces</p></li>
</ul>
</div>
<div class="section" id="from-these-analysis-we-conclude-that-we-need-population-level-analysis-duh">
<h3>From these analysis we conclude that we need population level analysis (duh)<a class="headerlink" href="#from-these-analysis-we-conclude-that-we-need-population-level-analysis-duh" title="Permalink to this headline">¶</a></h3>
<p>Now next question is exploring calcium traces and if there are recurring themes in responses.</p>
</div>
</div>
<div class="section" id="nearest-neighbor-analysis">
<h2>Nearest Neighbor analysis<a class="headerlink" href="#nearest-neighbor-analysis" title="Permalink to this headline">¶</a></h2>
<p>In this section I use nearest neighbor kind of analysis to see if there are some types of responses that occur more in certain trial types.</p>
<div class="section" id="id1">
<h3>Trial labels<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dff_trial</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">df_trial</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NearestNeighbors(n_jobs=-1, n_neighbors=101, radius=0.4)
</pre></div>
</div>
</div>
</div>
<div class="section" id="connectivity-matrix">
<h4>Connectivity matrix<a class="headerlink" href="#connectivity-matrix" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distances</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">kneighbors_graph</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-top-30-neighbors">
<h4>Plot top 30 neighbors<a class="headerlink" href="#plot-top-30-neighbors" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1508</span>
<span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">neighbor_indxs</span><span class="p">[</span><span class="n">neighbor_indxs</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_46_0.png" src="_images/processing_46_0.png" />
</div>
</div>
</div>
<div class="section" id="find-label-for-top-30-neighbors">
<h4>Find label for top 30 neighbors<a class="headerlink" href="#find-label-for-top-30-neighbors" title="Permalink to this headline">¶</a></h4>
<p>label source data point</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;correctreject&#39;
</pre></div>
</div>
</div>
</div>
<p>and its neighbors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;falsealarm&#39;, &#39;correctreject&#39;, &#39;falsealarm&#39;, &#39;correctreject&#39;,
       &#39;hit&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;falsealarm&#39;, &#39;correctreject&#39;, &#39;miss&#39;, &#39;miss&#39;, &#39;correctreject&#39;,
       &#39;correctreject&#39;, &#39;falsealarm&#39;, &#39;falsealarm&#39;, &#39;falsealarm&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;falsealarm&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;miss&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;,
       &#39;hit&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;correctreject&#39;,
       &#39;hit&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;hit&#39;,
       &#39;hit&#39;, &#39;hit&#39;, &#39;falsealarm&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;hit&#39;, &#39;hit&#39;,
       &#39;hit&#39;, &#39;hit&#39;, &#39;correctreject&#39;, &#39;falsealarm&#39;, &#39;correctreject&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;falsealarm&#39;, &#39;correctreject&#39;,
       &#39;hit&#39;, &#39;hit&#39;, &#39;hit&#39;, &#39;falsealarm&#39;, &#39;miss&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;falsealarm&#39;, &#39;hit&#39;, &#39;correctreject&#39;,
       &#39;falsealarm&#39;, &#39;hit&#39;, &#39;falsealarm&#39;, &#39;hit&#39;, &#39;correctreject&#39;, &#39;miss&#39;,
       &#39;falsealarm&#39;, &#39;correctreject&#39;, &#39;hit&#39;, &#39;correctreject&#39;,
       &#39;falsealarm&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;hit&#39;, &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;hit&#39;,
       &#39;correctreject&#39;, &#39;correctreject&#39;, &#39;miss&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="do-neighbors-have-more-or-less-the-same-label">
<h4>Do neighbors have more or less the same label?<a class="headerlink" href="#do-neighbors-have-more-or-less-the-same-label" title="Permalink to this headline">¶</a></h4>
<p>If yes, then there is information in each trace about trial types</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coocerances</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">-</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trials</span> <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))):</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">neighbor_indxs</span><span class="p">[</span><span class="n">neighbor_indxs</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">-</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
        <span class="n">coocerances</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 204736/204736 [00:27&lt;00:00, 7487.21it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">trials</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">trials</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">t1</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">t2</span> <span class="ow">in</span> <span class="n">trials</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">-</span><span class="si">{:s}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
        <span class="n">joint</span><span class="p">[</span><span class="n">l2i</span><span class="p">[</span><span class="n">t1</span><span class="p">],</span> <span class="n">l2i</span><span class="p">[</span><span class="n">t2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">coocerances</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
<span class="n">joint</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">p_x</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">p_y</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_given_x</span> <span class="o">=</span> <span class="n">joint</span> <span class="o">/</span> <span class="n">p_x</span>
<span class="n">x_given_y</span> <span class="o">=</span> <span class="n">joint</span> <span class="o">/</span> <span class="n">p_y</span>

<span class="n">kl</span> <span class="o">=</span> <span class="n">y_given_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_given_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">)</span>
<span class="n">mi</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">*</span> <span class="n">y_given_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_given_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">)</span>
<span class="n">mi_max</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">p_y</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">joint</span> <span class="o">/</span> <span class="n">p_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i2l</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">i2l</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i2l</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">i2l</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mi: </span><span class="si">{:.2e}</span><span class="s1">,  max mi: </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">mi_max</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_53_0.png" src="_images/processing_53_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mi: 1.27e-03,  max mi: 1.19e+00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-trial-label">
<h4>Conclusion: there is not much of shared structure in single cell traces as a function of trial label<a class="headerlink" href="#conclusion-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-trial-label" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="stim-frequencies">
<h3>Stim frequencies<a class="headerlink" href="#stim-frequencies" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">dff_freq</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">df_freq</span><span class="o">.</span><span class="n">freq</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NearestNeighbors(n_jobs=-1, n_neighbors=101, radius=0.4)
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4>Connectivity matrix<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distances</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">kneighbors_graph</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h4>Plot top 30 neighbors<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">neighbor_indxs</span><span class="p">[</span><span class="n">neighbor_indxs</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_61_0.png" src="_images/processing_61_0.png" />
</div>
</div>
</div>
<div class="section" id="id4">
<h4>Find label for top 30 neighbors<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>label source data point</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9899
</pre></div>
</div>
</div>
</div>
<p>and its neighbors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 9899, 19799, 19799, 19799,  9899,  9899, 19799, 19799, 14000,
        9899,  9899,  9899, 14000, 19799,  7000, 14000,  9899,  9899,
        7000, 14000,  9899,  7000,  9899, 14000, 14000, 19799, 14000,
       19799,  7000,  9899, 14000,  7000,  7000,  9899, 19799, 19799,
        9899,  9899,  9899, 19799,  9899,  7000, 14000, 19799, 14000,
        9899,  9899,  7000, 14000,  9899, 14000,  9899, 14000, 14000,
        9899,  7000, 14000,  9899, 14000,  9899,  9899, 14000, 14000,
        7000,  7000,  9899,  9899, 14000,  9899, 19799, 19799,  7000,
       14000, 19799,  7000,  7000, 14000, 19799, 19799,  7000,  9899,
       14000, 14000, 14000, 14000, 19799,  7000, 14000, 19799,  9899,
       19799,  9899, 14000, 14000, 19799, 19799, 19799, 19799, 19799,
       14000], dtype=int16)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h4>Do neighbors have more or less the same label?<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>If yes, then there is information in each trace about stim frequency</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">coocerances</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">):</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">f1</span> <span class="ow">in</span> <span class="n">freqs</span> <span class="k">for</span> <span class="n">f2</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))):</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">neighbor_indxs</span> <span class="o">=</span> <span class="n">neighbor_indxs</span><span class="p">[</span><span class="n">neighbor_indxs</span> <span class="o">!=</span> <span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">f2</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">neighbor_indxs</span><span class="p">]:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
        <span class="n">coocerances</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 251419/251419 [00:48&lt;00:00, 5186.60it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">joint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">f1</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">f2</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:d}</span><span class="s1">-</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
        <span class="n">joint</span><span class="p">[</span><span class="n">f2i</span><span class="p">[</span><span class="n">f1</span><span class="p">],</span> <span class="n">f2i</span><span class="p">[</span><span class="n">f2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">coocerances</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<span class="n">joint</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">p_x</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">p_y</span> <span class="o">=</span> <span class="n">joint</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_given_x</span> <span class="o">=</span> <span class="n">joint</span> <span class="o">/</span> <span class="n">p_x</span>
<span class="n">x_given_y</span> <span class="o">=</span> <span class="n">joint</span> <span class="o">/</span> <span class="n">p_y</span>

<span class="n">kl</span> <span class="o">=</span> <span class="n">y_given_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_given_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">)</span>
<span class="n">mi</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">*</span> <span class="n">y_given_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_given_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">)</span>
<span class="n">mi_max</span> <span class="o">=</span> <span class="n">p_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">p_y</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">joint</span> <span class="o">/</span> <span class="n">p_x</span> <span class="o">/</span> <span class="n">p_y</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bwr&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i2f</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">i2f</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i2f</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="n">i2f</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mi: </span><span class="si">{:.2e}</span><span class="s1">,  max mi: </span><span class="si">{:.2e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mi</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">mi_max</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/processing_68_0.png" src="_images/processing_68_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mi: 3.02e-04,  max mi: 1.39e+00
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="conclusion-similarly-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-stim-frequency">
<h4>Conclusion: similarly, there is not much of shared structure in single cell traces as a function of stim frequency<a class="headerlink" href="#conclusion-similarly-there-is-not-much-of-shared-structure-in-single-cell-traces-as-a-function-of-stim-frequency" title="Permalink to this headline">¶</a></h4>
<p>However, from stucture of the joint probability distribution we see that there is information with discriminatory power encoded in individual traces that separates target with non target frequencies.  All the analysis so far hit that we must focus on population level analysis somehow.</p>
</div>
</div>
</div>
<div class="section" id="simply-looking-at-averages-is-misleading">
<h2>Simply looking at averages is misleading<a class="headerlink" href="#simply-looking-at-averages-is-misleading" title="Permalink to this headline">¶</a></h2>
<p>There are cells that respond consistently across trials for the same trial type, but most cells have varying responses.  Below, I am plotting responses from individual cells across trials.  There are 3 horizontal dashed lines that separate trials in the following order. Top to bottom: <strong>hit</strong>, <strong>miss</strong>, <strong>correctreject</strong>, and <strong>falsealaram</strong>.  As we can see from these figures, different cells exhibit different selectivity.  Some behave almost the same during different trials, and some have clear responses that has discriminatory power.</p>
<div class="section" id="example-1-a-cell-that-is-highly-active-during-hit-and-falsealarm-trials">
<h3>Example 1: a cell that is highly active during hit and falsealarm trials<a class="headerlink" href="#example-1-a-cell-that-is-highly-active-during-hit-and-falsealarm-trials" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rodger_2017-08-20&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "13ac1ba18880489ba095a387a20f6d73", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_72_2.png" src="_images/processing_72_2.png" />
</div>
</div>
</div>
<div class="section" id="example-2-a-cell-that-is-highly-active-during-hit-but-not-consistently">
<h3>Example 2: a cell that is highly active during hit, but not consistently.<a class="headerlink" href="#example-2-a-cell-that-is-highly-active-during-hit-but-not-consistently" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rodger_2017-08-20&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5960d15c6ff0414092ad7d5d195b0e57", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_74_2.png" src="_images/processing_74_2.png" />
</div>
</div>
</div>
<div class="section" id="example-3-excited-during-hit-and-falsealaram-inhibited-during-miss-and-correctreject">
<h3>Example 3: excited during hit and falsealaram, inhibited during miss and correctreject<a class="headerlink" href="#example-3-excited-during-hit-and-falsealaram-inhibited-during-miss-and-correctreject" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rodger_2017-08-20&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "8f6c94840d06489b8210627740e2f8b6", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_76_2.png" src="_images/processing_76_2.png" />
</div>
</div>
</div>
<div class="section" id="example-4-seems-random">
<h3>Example 4: seems random<a class="headerlink" href="#example-4-seems-random" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rodger_2017-08-20&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">37</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ca3c06946e4049d1b43e84937e78566d", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_78_2.png" src="_images/processing_78_2.png" />
</div>
</div>
</div>
<div class="section" id="example-5-highly-active-during-correctreject-and-to-some-extent-during-hit">
<h3>Example 5: highly active during correctreject, and to some extent during hit<a class="headerlink" href="#example-5-highly-active-during-correctreject-and-to-some-extent-during-hit" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scabbers_2016-09-23&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "5cd946dafc10453590145d3ce47c2869", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_80_2.png" src="_images/processing_80_2.png" />
</div>
</div>
</div>
<div class="section" id="example-6-can-be-used-to-classify-hit-vs-antything-else">
<h3>Example 6: can be used to classify hit vs antything else<a class="headerlink" href="#example-6-can-be-used-to-classify-hit-vs-antything-else" title="Permalink to this headline">¶</a></h3>
<p>But even this cell shows some variance during hit trials</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scabbers_2016-09-23&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "0fd3ad5ec958477fb28649a7a1d3b718", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_82_2.png" src="_images/processing_82_2.png" />
</div>
</div>
</div>
<div class="section" id="example-7-another-random-cell">
<h3>Example 7: another random cell<a class="headerlink" href="#example-7-another-random-cell" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">mk_single_cell_plot</span><span class="p">(</span>
    <span class="n">df</span><span class="o">=</span><span class="n">df_all</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;scabbers_2016-09-23&quot;</span><span class="p">,</span>
    <span class="n">cell</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "175c639bd75c41c698ce60986e688d35", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="_images/processing_84_2.png" src="_images/processing_84_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<p>It is extremely unlikely that we will be able to detect trial labels by just looking at individual traces from individual cells.  We need a population level analysis (this is obvious, but had to check a few things to get this out of my system).  How can we do this?  A major challenge remains:</p>
<blockquote>
<div><p><strong>How can we combine datasets, knowing that each experiment is different with different number of cells. Each cell in each trial in each experiment is doing something different.</strong></p>
</div></blockquote>
<ul class="simple">
<li><p>I’m thinking of a few possiblities, now informed by all of these analysis.  Will design simulation to test wether those ideas can work.</p></li>
<li><p>I will try to concretely identify the hypothesis and assumptions to discuss and make sure they are reasonable.  Basically I’m inspired by random projection theory and <a class="reference external" href="https://www.biorxiv.org/content/10.1101/214262v2">this Ganguli paper</a>.</p></li>
</ul>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="sec1.html" title="previous page">Section 1</a>
    <a class='right-next' id="next-link" href="clf.html" title="next page">Classification Analysis</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hadi Vafaii<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>